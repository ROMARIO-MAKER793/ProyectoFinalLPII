<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Lista de Clientes - Cine Online</title>

  <!-- Fuente Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: "Poppins", sans-serif;
    }

    .active-link {
      background: linear-gradient(90deg, #1e3a8a, #2563eb);
      color: #fff !important;
      font-weight: 600;
    }
    .active-link i {
      color: #fff !important;
    }

    table.dataTable thead {
      background-color: #1e3a8a !important;
      color: white;
    }
    .btn-action {
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-800">

  <!-- Header -->
  <header class="fixed top-0 w-full z-50 bg-white shadow-sm flex items-center justify-between px-8 py-4 border-b border-gray-200">
    <div class="flex items-center gap-3 text-xl font-semibold text-gray-800">
      <i class="fa-solid fa-clapperboard text-blue-700"></i>
      <span>Panel de Administración - Cine Online</span>
    </div>
    <div class="text-gray-600">
      Bienvenido Administrador <span class="text-blue-700 font-medium" th:text="${adminNombre}">admin@example.com</span>
    </div>
  </header>

  <!-- Layout principal -->
  <div class="flex pt-20 min-h-screen">

    <!-- Sidebar -->
    <aside class="w-64 bg-gray-900 text-gray-200 fixed top-20 left-0 h-[calc(100vh-5rem)] overflow-y-auto shadow-xl rounded-r-3xl">
      <nav class="flex flex-col mt-6 space-y-1">
        <a th:href="@{/mantenimientoPeliculas/lista}" class="flex items-center gap-3 px-6 py-3 hover:bg-gray-800 rounded-lg transition-all">
          <i class="fa-solid fa-film text-blue-400"></i>
          <span>Lista de Películas</span>
        </a>
        <a th:href="@{/mantenimientoPeliculas/nuevo}" class="flex items-center gap-3 px-6 py-3 hover:bg-gray-800 rounded-lg transition-all">
          <i class="fa-solid fa-circle-plus text-blue-400"></i>
          <span>Registrar Película</span>
        </a>
        <a th:href="@{/PaginaAdmin/funciones/listar}" class="flex items-center gap-3 px-6 py-3 hover:bg-gray-800 rounded-lg transition-all">
          <i class="fa-solid fa-calendar-days text-blue-400"></i>
          <span>Listar Funciones</span>
        </a>
        <a th:href="@{/Cliente/listar}" class="flex items-center gap-3 px-6 py-3 active-link rounded-lg transition-all">
          <i class="fa-solid fa-users text-blue-400"></i>
          <span>Lista de Clientes</span>
        </a>
        <hr class="my-2 border-gray-700">
        <a th:href="@{/logout}" class="flex items-center gap-3 px-6 py-3 hover:bg-red-600 rounded-lg transition-all">
          <i class="fa-solid fa-right-from-bracket text-red-400"></i>
          <span>Cerrar sesión</span>
        </a>
      </nav>
    </aside>

    <!-- Contenido -->
    <main class="ml-64 flex-1 p-10">
      <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center gap-2">
        <i class="fa-solid fa-users text-blue-700"></i> Clientes Registrados
      </h2>

      <!-- Mensajes -->
      <div th:if="${param.msg=='ok'}" class="alert alert-success mb-4">✅ Cliente actualizado correctamente.</div>
      <div th:if="${param.msg=='fail'}" class="alert alert-danger mb-4">❌ Error al actualizar el cliente.</div>
      <div th:if="${param.msg=='okEliminar'}" class="alert alert-success mb-4">✅ Cliente eliminado correctamente.</div>
      <div th:if="${param.msg=='failEliminar'}" class="alert alert-danger mb-4">❌ Error al eliminar el cliente.</div>

      <!-- Tabla -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
        <table id="tablaClientes" class="table table-striped table-bordered text-sm align-middle w-full">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Teléfono</th>
              <th>Género</th>
              <th>Fecha Nac.</th>
              <th>Correo</th>
              <th class="text-center">Opciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="clie : ${listaClientes}">
              <td th:text="${clie.idCliente}"></td>
              <td th:text="${clie.nombres + ' ' + clie.apellidos}"></td>
              <td th:text="${clie.telefono}"></td>
              <td th:text="${clie.genero}"></td>
              <td th:text="${clie.fechaNacimiento}"></td>
              <td th:text="${clie.usuario.correo}"></td>
              <td class="text-center">
                <button class="btn btn-primary btn-sm btn-action me-2"
                        data-bs-toggle="modal"
                        data-bs-target="#editarModal"
                        th:data-idcliente="${clie.idCliente}"
                        th:data-idusuario="${clie.usuario.idUsuario}"
                        th:data-nombres="${clie.nombres}"
                        th:data-apellidos="${clie.apellidos}"
                        th:data-telefono="${clie.telefono}"
                        th:data-genero="${clie.genero}"
                        th:data-fechanacimiento="${clie.fechaNacimiento}"
                        th:data-correo="${clie.usuario.correo}">
                  <i class="fa-solid fa-pen-to-square"></i> Editar
                </button>
                <form th:action="@{/Cliente/eliminar}" method="post" class="inline" 
                      onsubmit="return confirm('¿Seguro que deseas eliminar este cliente?');">
                  <input type="hidden" name="idCliente" th:value="${clie.idCliente}">
                  <button type="submit" class="btn btn-danger btn-sm btn-action">
                    <i class="fa-solid fa-trash"></i> Eliminar
                  </button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- Modal Editar -->
  <div class="modal fade" id="editarModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-xl border-0 shadow-lg">
        <form th:action="@{/Cliente/actualizar}" method="post">
          <div class="modal-header bg-blue-700 text-white rounded-t-xl">
            <h5 class="modal-title"><i class="fa-solid fa-pen-to-square me-2"></i>Editar Cliente</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body p-4 space-y-3">
            <input type="hidden" name="idCliente" id="modalIdCliente">
            <input type="hidden" name="idUsuario" id="modalIdUsuario">

            <div>
              <label class="form-label">Nombres</label>
              <input type="text" class="form-control" id="modalNombres" name="nombres" required>
            </div>
            <div>
              <label class="form-label">Apellidos</label>
              <input type="text" class="form-control" id="modalApellidos" name="apellidos" required>
            </div>
            <div>
              <label class="form-label">Teléfono</label>
              <input type="text" class="form-control" id="modalTelefono" name="telefono" required>
            </div>
            <div>
              <label class="form-label">Género</label>
              <select class="form-select" id="modalGenero" name="genero" required>
                <option value="Hombre">Hombre</option>
                <option value="Mujer">Mujer</option>
              </select>
            </div>
            <div>
              <label class="form-label">Fecha de Nacimiento</label>
              <input type="date" class="form-control" id="modalFechaNacimiento" name="fechaNacimiento" required>
            </div>
            <div>
              <label class="form-label">Correo</label>
              <input type="email" class="form-control" id="modalCorreo" name="correo" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#tablaClientes').DataTable({
        language: {
          url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
        }
      });

      $('#editarModal').on('show.bs.modal', function(event) {
        var button = $(event.relatedTarget);
        $('#modalIdCliente').val(button.data('idcliente'));
        $('#modalIdUsuario').val(button.data('idusuario'));
        $('#modalNombres').val(button.data('nombres'));
        $('#modalApellidos').val(button.data('apellidos'));
        $('#modalTelefono').val(button.data('telefono'));
        $('#modalGenero').val(button.data('genero'));
        $('#modalFechaNacimiento').val(button.data('fechanacimiento'));
        $('#modalCorreo').val(button.data('correo'));
      });
    });
  </script>
</body>
</html>
