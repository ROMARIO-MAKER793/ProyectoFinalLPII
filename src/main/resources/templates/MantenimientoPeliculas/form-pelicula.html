<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registrar / Editar Película - Cine Online</title>

  <!-- Fuente Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 font-poppins">

  <!-- Header -->
  <header class="fixed top-0 w-full z-50 bg-white shadow flex items-center justify-between px-6 py-4">
    <div class="flex items-center gap-3 text-lg font-semibold text-gray-800">
      <i class="fa-solid fa-clapperboard text-indigo-500"></i>
      Panel de Administración - Cine Online
    </div>
  </header>

  <!-- Layout -->
  <div class="flex pt-20 min-h-screen">

    <!-- Sidebar -->
    <aside class="w-60 bg-gray-900 text-gray-200 fixed top-20 left-0 h-[calc(100vh-5rem)] shadow-lg">
      <nav class="flex flex-col mt-4 text-sm">
        <a th:href="@{/mantenimientoPeliculas/lista}" class="flex items-center gap-3 px-6 py-3 hover:bg-gray-800 rounded transition-all">
          <i class="fa-solid fa-film text-indigo-400"></i> Lista de Películas
        </a>
        <a th:href="@{/mantenimientoPeliculas/nuevo}" class="flex items-center gap-3 px-6 py-3 bg-gray-800 text-white rounded transition-all">
          <i class="fa-solid fa-plus text-indigo-400"></i> Registrar Película
        </a>
        <a th:href="@{/PaginaAdmin/funciones/listar}" class="flex items-center gap-3 px-6 py-3 hover:bg-gray-800 rounded transition-all">
          <i class="fa-solid fa-calendar-days text-indigo-400"></i> Listar Funciones
        </a>
        <a th:href="@{/Cliente/listar}" class="flex items-center gap-3 px-6 py-3 hover:bg-gray-800 rounded transition-all">
          <i class="fa-solid fa-users text-indigo-400"></i> Lista de Clientes
        </a>
        <div class="border-t border-gray-700 my-3"></div>
        <a th:href="@{/logout}" class="flex items-center gap-3 px-6 py-3 hover:bg-red-600 rounded transition-all text-red-400 font-medium">
          <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión
        </a>
      </nav>
    </aside>

	<!-- Contenido principal -->
	<main class="ml-60 flex-1 p-8 bg-gray-50 min-h-screen">
	  <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden">

	    <!-- Encabezado con fondo degradado -->
	    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 py-6 text-center">
	      <h2 th:text="${pelicula.idPelicula == null} ? 'Registrar Nueva Película' : 'Editar Película'"
	          class="text-3xl font-bold text-white tracking-wide">
	      </h2>
	    </div>

	    <div class="p-8">
	      <form th:action="@{/mantenimientoPeliculas/guardar}" th:object="${pelicula}" method="post" enctype="multipart/form-data">
	        <input type="hidden" th:field="*{idPelicula}" />

	        <!-- Campos -->
	        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
	          <div>
	            <label class="font-semibold text-gray-700">Título</label>
	            <input type="text" th:field="*{titulo}" class="form-control mt-1 rounded-lg shadow-sm" required>
	          </div>

	          <div>
	            <label class="font-semibold text-gray-700">Duración (min)</label>
	            <input type="number" th:field="*{duracion}" min="30" class="form-control mt-1 rounded-lg shadow-sm" required>
	          </div>

	          <div>
	            <label class="font-semibold text-gray-700">Idioma</label>
	            <input type="text" th:field="*{idioma}" class="form-control mt-1 rounded-lg shadow-sm" required>
	          </div>

	          <div>
	            <label class="font-semibold text-gray-700">Clasificación</label>
	            <select th:field="*{clasificacion.idClasificacion}" class="form-select mt-1 rounded-lg shadow-sm" required>
	              <option th:each="c : ${clasificaciones}"
	                      th:value="${c.idClasificacion}"
	                      th:text="${c.etiqueta}"
	                      th:selected="${pelicula.clasificacion != null} ? ${c.idClasificacion} == ${pelicula.clasificacion.idClasificacion} : false">
	              </option>
	            </select>
	          </div>

	          <div class="md:col-span-2">
	            <label class="font-semibold text-gray-700">Descripción</label>
	            <textarea th:field="*{descripcion}" rows="3" class="form-control mt-1 rounded-lg shadow-sm" required></textarea>
	          </div>

	          <div>
	            <label class="font-semibold text-gray-700">Fecha de Estreno</label>
	            <input type="date" th:field="*{fechaEstreno}" class="form-control mt-1 rounded-lg shadow-sm" required>
	          </div>

	          <div>
	            <label class="font-semibold text-gray-700">Precio (S/)</label>
	            <input type="number" th:field="*{precio}" step="0.10" min="0" class="form-control mt-1 rounded-lg shadow-sm" required>
	          </div>

	          <div>
	            <label class="font-semibold text-gray-700">Estado</label>
	            <select th:field="*{estado}" class="form-select mt-1 rounded-lg shadow-sm">
	              <option value="ACTIVO" th:selected="${pelicula.estado == 'ACTIVO'}">Activo</option>
	              <option value="INACTIVO" th:selected="${pelicula.estado == 'INACTIVO'}">Inactivo</option>
	            </select>
	          </div>

	          <div>
	            <label class="font-semibold text-gray-700">Géneros</label>
	            <select th:field="*{generos}" multiple class="form-select mt-1 rounded-lg shadow-sm" required>
	              <option th:each="g : ${generos}"
	                      th:value="${g.idGenero}"
	                      th:text="${g.nombreGenero}"
	                      th:selected="${pelicula.generos != null} ? ${pelicula.generos.contains(g)} : false">
	              </option>
	            </select>
	            <small class="text-gray-500 text-sm">Mantén presionada Ctrl (o Cmd) para seleccionar varios.</small>
	          </div>
	        </div>

	        <!-- Imagen -->
	        <div class="mt-6">
	          <label class="font-semibold text-gray-700">Imagen actual</label>
	          <div th:if="${pelicula.imagen != null}" class="my-2">
	            <img th:src="@{/img/{img}(img=${pelicula.imagen})}" alt="Película" class="w-32 h-32 object-cover rounded-md shadow">
	          </div>
	          <input type="file" name="imagenArchivo" class="form-control mt-2 rounded-lg shadow-sm">
	        </div>

	        <!-- Botón -->
	        <div class="text-center mt-10">
	          <button type="submit"
	                  class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-[1.02]">
	            <i class="fa-solid fa-floppy-disk me-2"></i> Guardar Película
	          </button>
	        </div>
	      </form>
	    </div>
	  </div>
	</main>


	<!-- marcador en el HTML -->
	<div id="msg-container" th:data-msg="${msg}"></div>

	<script>
	  const mensaje = document.getElementById('msg-container').dataset.msg;

	  if (mensaje === 'ok') {
	    Swal.fire({ icon: 'success', title: 'Película guardada correctamente', text: 'La película se ha registrado o editado exitosamente.' });
	  } else if (mensaje === 'exception') {
	    Swal.fire({ icon: 'error', title: 'Error al guardar', text: 'Ocurrió un error inesperado. Inténtalo nuevamente.' });
	  }
	</script>


</body>
</html>
