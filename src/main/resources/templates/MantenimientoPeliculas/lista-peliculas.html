<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lista de Películas - Cine Online</title>

    <!-- Fuente Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Tailwind (utilizado para utilidades rápidas) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- DataTables (Bootstrap integration) -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">

    <style>
      /* Tipografía global */
      body { font-family: "Poppins", sans-serif; }

      /* Sidebar / active */
      .active-link {
        background: linear-gradient(90deg, #1e3a8a, #2563eb);
        color: #fff !important;
        font-weight: 600;
      }
      .active-link i { color: #fff !important; }

      /* Cabecera de DataTable */
      table.dataTable thead th, .dataTables_wrapper .dataTables_length select {
        background-color: #1e3a8a !important;
        color: #fff !important;
      }

      /* Botones de acción (pequeños y consistentes) */
      .btn-action {
        border-radius: 6px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 6px 8px;
        font-size: 0.85rem;
        font-weight: 600;
      }

      /* Card y tabla */
      .card-table {
        border-radius: 12px;
      }

      /* Scrollbar (sutil) */
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-thumb { background: rgba(99,102,241,0.25); border-radius: 8px; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Header -->
  <header class="fixed top-0 w-full z-50 bg-white shadow-sm flex items-center justify-between px-6 py-3 border-b border-gray-200">
    <div class="flex items-center gap-3 text-lg font-semibold text-gray-800">
      <i class="fa-solid fa-clapperboard text-indigo-600"></i>
      <span>Panel de Administración - Cine Online</span>
    </div>
    <div class="text-gray-600 text-sm md:text-base">
      Bienvenido: <span class="font-medium text-indigo-600" th:text="${adminNombre}">Administrador</span>
    </div>
  </header>

  <!-- Layout -->
  <div class="flex pt-16 min-h-screen">

    <!-- Sidebar -->
    <aside class="w-64 bg-gray-900 text-gray-300 fixed top-16 left-0 h-[calc(100vh-4rem)] shadow-xl rounded-r-2xl overflow-auto">
      <nav class="flex flex-col mt-6 text-sm">
        <a th:href="@{/mantenimientoPeliculas/lista}"
           class="flex items-center gap-3 px-6 py-3 active-link rounded-lg transition-all">
          <i class="fa-solid fa-film"></i>
          <span>Lista de Películas</span>
        </a>

        <a th:href="@{/mantenimientoPeliculas/nuevo}"
           class="flex items-center gap-3 px-6 py-3 hover:bg-gray-800 rounded-lg transition-all">
          <i class="fa-solid fa-circle-plus text-blue-400"></i>
          <span>Registrar Película</span>
        </a>

        <a th:href="@{/PaginaAdmin/funciones/listar}"
           class="flex items-center gap-3 px-6 py-3 hover:bg-gray-800 rounded-lg transition-all">
          <i class="fa-solid fa-calendar-days text-blue-400"></i>
          <span>Listar Funciones</span>
        </a>

        <a th:href="@{/Cliente/listar}"
           class="flex items-center gap-3 px-6 py-3 hover:bg-gray-800 rounded-lg transition-all">
          <i class="fa-solid fa-users text-blue-400"></i>
          <span>Lista de Clientes</span>
        </a>

        <div class="border-t border-gray-700 my-3"></div>

        <a th:href="@{/logout}"
           class="flex items-center gap-3 px-6 py-3 hover:bg-red-600 rounded-lg transition-all text-red-400 font-medium mt-auto">
          <i class="fa-solid fa-right-from-bracket"></i>
          <span>Cerrar sesión</span>
        </a>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="ml-64 flex-1 p-8">

      <h2 class="text-3xl font-bold text-gray-800 mb-6">Películas Registradas</h2>

      <!-- Mensajes -->
      <div th:if="${param.msg == 'editOk'}" class="alert alert-success mb-4 shadow-sm">Se editó la película correctamente.</div>
      <div th:if="${param.msg == 'addOk'}" class="alert alert-success mb-4 shadow-sm">Se registró la película correctamente.</div>
      <div th:if="${param.msg == 'delOk'}" class="alert alert-warning mb-4 shadow-sm">Se eliminó la película correctamente.</div>
      <div th:if="${param.msg == 'error'}" class="alert alert-danger mb-4 shadow-sm">Ocurrió un error, inténtelo nuevamente.</div>

      <!-- Tabla -->
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 card-table">
        <div class="table-responsive">
          <table id="tablaPeliculas" class="table table-striped table-hover table-bordered w-100 align-middle" style="width:100%">
            <thead class="text-white">
              <tr>
                <th>ID</th>
                <th>Imagen</th>
                <th>Título</th>
                <th>Duración</th>
                <th>Idioma</th>
                <th>Clasificación</th>
                <th>Géneros</th>
                <th>Fecha Estreno</th>
                <th>Precio</th>
                <th>Estado</th>
                <th class="text-center">Opciones</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="p : ${listaPeliculas}" class="bg-white">
                <td th:text="${p.idPelicula}"></td>

                <td>
                  <img th:src="@{/img/{img}(img=${p.imagen})}" alt="Película" class="w-16 h-16 object-cover rounded">
                </td>

                <td th:text="${p.titulo}"></td>
                <td th:text="${p.duracion + ' min'}"></td>
                <td th:text="${p.idioma}"></td>
                <td th:text="${p.clasificacion.etiqueta}"></td>
                <td>
                  <span th:each="g : ${p.generos}" th:text="${g.nombreGenero} + ' '"></span>
                </td>
                <td th:text="${#dates.format(p.fechaEstreno, 'dd/MM/yyyy')}"></td>
                <td th:text="'S/. ' + ${p.precio}"></td>

                <td>
                  <span th:text="${p.estado}"
                        class="px-2 py-1 rounded text-xs font-semibold"
                        th:classappend="${p.estado == 'Activo'} ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'">
                  </span>
                </td>

                <td class="text-center">
                  <div class="d-flex justify-content-center gap-2">
                    <a th:href="@{/mantenimientoPeliculas/editar/{id}(id=${p.idPelicula})}"
                       class="btn btn-primary btn-sm btn-action" title="Editar">
                      <i class="fa-solid fa-pen-to-square"></i>
                    </a>

                    <a th:href="@{/mantenimientoPeliculas/eliminar/{id}(id=${p.idPelicula})}"
                       th:onclick="return confirm('¿Seguro que deseas eliminar esta película?');"
                       class="btn btn-danger btn-sm btn-action" title="Eliminar">
                      <i class="fa-solid fa-trash"></i>
                    </a>

                    <a th:href="@{/mantenimientoPeliculas/ver/{id}(id=${p.idPelicula})}"
                       class="btn btn-info btn-sm btn-action" title="Ver">
                      <i class="fa-solid fa-eye"></i>
                    </a>

                    <a th:href="@{/PaginaAdmin/funciones/nuevo/{idPelicula}(idPelicula=${p.idPelicula})}"
                       class="btn btn-warning btn-sm btn-action" title="Registrar función">
                      <i class="fa-solid fa-calendar-plus"></i>
                    </a>
                  </div>
                </td>

              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </main>
  </div>

  <!-- Scripts: jQuery, Bootstrap, DataTables -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

  <script>
    $(document).ready(function() {
      // Inicialización de DataTable (español)
      $('#tablaPeliculas').DataTable({
        language: {
          url: "//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
        },
        pageLength: 5,
        lengthMenu: [5, 10, 25, 50],
        columnDefs: [
          { orderable: false, targets: [1, 10] } // imagen y opciones no ordenables
        ],
        // Mantener la cabecera con el color del estilo (se aplica por CSS)
        initComplete: function(settings, json) {
          // puedes agregar comportamiento extra aquí si lo necesitas
        }
      });
    });
  </script>

</body>
</html>
